<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Covid-19 Map: Global Deaths Per Day</title>

    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&family=Jost:ital,wght@0,400;0,500;1,400;1,500&family=Kumbh+Sans:wght@300;400;700&family=Nunito+Sans:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600;1,700&family=Sen:wght@400;700&Crimson+Text:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">

    <script src="../assets/scripts.js"></script>
    <link rel="stylesheet" href="../assets/app.css?v=1.1">

    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
    <script type="text/javascript" src="src/json.js"></script>

</head>

<body class="article" onload="mainfunc()">
    <header id="siteHeader" class="site-header"></header>
    <main>
        <article>
            <figure class="feature-chart">
                <!-- <img src="../assets/img/covid.jpg" alt="Covid nurse in hospital"> -->
                <div id='map'>
                    <div id="sliderContainer" style="position: absolute; left: 10px; bottom: 10px; background-color: white; display: flex; justify-content: center; align-items: center; z-index: 5000">
                        <input type="range" id="timeSlider" min="4" max="241" value="1" style="float: left; padding: 6px;" oninput="updateTime(this.value);" onchange="updateTime(this.value);">
                        <div id="currentTime" style="float: left; padding-left: 6px; padding-right: 6px;"></div>
                    </div>
                </div>
            </figure>
            <header class="entry-header">
                <h1>Covid-19 Map: Deaths Per Day Per Country</h1>
                <p>See how Covid-19 is spreading accross the world.</p>
            </header>
            <div class="entry-content">
                <section class="chart full-width animated-map">
                   
                    <script>
                        var timeIndex = 4;
                        var times = [];
                       
                        function addInformation(data) {
                            // control that shows state info on hover
                            info = L.control();
                            // console.log(data)
                            info.onAdd = function(map) {
                                this._div = L.DomUtil.create('div', 'info');
                                labels = [];
                
                
                                labels.push('<h3>Total Covid-19 deaths per day per country</h3>');               
                                this._div.innerHTML = labels.join('');
                
                                return this._div;
                            };
                
                            info.update = function(id) {
                                
                                object = Object.entries(id);
                                let arrayD=object[1][1].timeSeries
                                
                                this._div.innerHTML = '<h4>Total Covid-19 deaths </h4>' + (id ?
                                    '<b>' + object[1][1].ADMIN + '</b><br />' :
                                    '');
                            };
                            
                
                            info.addTo(map);
                        }
                        var dataGeo = statesData;
                
                        map = L.map('map').setView([-40.30, -62.46], 4);
                        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                            maxZoom: 18,
                            attribution: '<a href="">Ghayth</a>',
                            id: 'mapbox/light-v9',
                            tileSize: 512,
                            zoomOffset: -1
                        }).addTo(map);
                
                
                        function getColor(d) {
                
                            return d > 100000 ? '#000' :
                                d > 50000 ? '#1d0109' :
                                d > 25000 ? '#4d0218' :
                                d > 1500 ? '#690020' :
                                d > 1000 ? '#800026' :
                                d > 500 ? '#BD0026' :
                                d > 200 ? '#E31A1C' :
                                d > 100 ? '#FC4E2A' :
                                d > 50 ? '#FD8D3C' :
                                d > 20 ? '#FEB24C' :
                                d > 10 ? '#FED976' :
                                '#FFEDA0';
                        }
                
                        function style(feature) {
                
                            if (feature.properties.timeSeries.length) {
                                
                                return {
                                    fillColor: getColor(feature.properties.timeSeries[timeIndex][1]),
                                    weight: 1,
                                    opacity: 1,
                                    color: '#888',
                                    dashArray: '3',
                                    fillOpacity: 1
                                };
                            }else{
                
                                return {
                                    fillColor: getColor(0),
                                    weight: 1,
                                    opacity: 1,
                                    color: '#f9f9f9',
                                    dashArray: '3',
                                    fillOpacity: 1
                                }; 
                            }
                
                
                        }
                
                        function createLegend() {
                
                            var legend = L.control({
                                position: 'bottomright'
                            });
                
                            legend.onAdd = function(map) {
                
                                var div = L.DomUtil.create('div', 'info legend'),
                                    grades = [0, 10, 20, 50, 100, 200, 500, 1000],
                                    labels = [],
                                    from, to;
                
                                labels.push(
                                    '<i>Deaths</i>');
                
                                for (var i = 0; i < grades.length; i++) {
                                    from = grades[i];
                                    to = grades[i + 1];
                
                                    labels.push(
                                        '<i style="background:' + getColor(from + 1) + '"></i> ' +
                                        from + (to ? '&ndash;' + to : '+'));
                                }
                
                                div.innerHTML = labels.join('<br>');
                                return div;
                            };
                
                            legend.addTo(map);
                
                        }
                
                        function highlightFeature(e) {
                            var layer = e.target;
                
                            layer.setStyle({
                                weight: 1,
                                color: '#666',
                                dashArray: '',
                                fillOpacity: 0.7
                            });
                
                            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                                layer.bringToFront();
                            }
                            info.update(layer.feature);
                            zoomToFeature(e)
                        }
                
                        function resetHighlight(e) {
                            geojson.resetStyle(e.target);
                        }
                
                        function zoomToFeature(e) {
                            console.log(e)
                            map.fitBounds(e.target.getBounds());
                        }
                
                        function onEachFeature(feature, layer) {
                              feature.properties.timeSeries.forEach(function (value, index) {
                                times.push(value[0]);
                              });
                            layer.on({
                                click: highlightFeature,
                                mouseout: resetHighlight,
                                // click: zoomToFeature
                            });
                
                        }
                        // console.log(dataGeo)
                        var geojson = L.geoJson(dataGeo, {
                            style: style,
                            onEachFeature: onEachFeature
                        }).addTo(map);
                
                        addInformation(dataGeo);
                
                        createLegend();
                
                        function updateTime(index) {
                            var time;
                
                            timeIndex = index;
                            geojson.setStyle(style);
                            time = times[timeIndex];
                            document.getElementById('currentTime').innerHTML = time
                
                        };
                
                        var sliderContainer = document.getElementById('sliderContainer');
                        L.DomEvent.disableClickPropagation(sliderContainer);
                        L.DomEvent.on(sliderContainer, 'click', L.DomEvent.stop);
                
                        map.fitBounds(geojson.getBounds());
                        updateTime(4);
                
                    </script>
                </section>
                






                <section class="regional-charts">
                    <header>
                        <h2>Which regions are worst affected by Covid-19?</h2>
                        <p>Number of new cases and number of new deaths per week, per region.</p>
                    </header>
                    <div class="multiple-charts six-charts">
                        <figure>
                            <div>
                            North America chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            South America chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Europe chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Africa and the Middle East chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Asia chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Australasia chart
                            </div>
                        </figure>
                    </div>
                </section>
                <section class="country-charts">
                    <header>
                        <h2>Which countries are worst affected by Covid-19?</h2>
                        <p>Number of new cases and number of new deaths per week, per region.</p>
                    </header>
                    <div class="multiple-charts twelve-charts">
                        <figure>
                            <div>
                            United States chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Canada chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Mexico chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            UK chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            France chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Italy chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Germany chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Sweden chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            China chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            South Africa chart
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Australia
                            </div>
                        </figure>
                        <figure>
                            <div>
                            Brazil
                            </div>
                        </figure>
                    </div>
                </section>
                
            </div>
            <!-- .entry-content -->
        </article>
    </main>

    <footer class="site-footer">
        <p>&copy; copyright 2021 Charting Change.</p>
    </footer>

</body>
</html>