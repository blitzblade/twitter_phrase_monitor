<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Every US Election Result in 60 Seconds</title>
    <meta name="description" content="The HTML5 Herald">
    <meta name="author" content="SitePoint">

    <link rel="stylesheet" href="assets/css.css?v=1.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css" integrity="sha512-/zs32ZEJh+/EO2N1b0PEdoA10JkdC3zJ8L5FTiQu82LR9S/rOQNfQN7U59U9BC12swNeRAz3HSzIL2vpp4fv3w==" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&family=Jost:ital,wght@0,400;0,500;1,400;1,500&family=Kumbh+Sans:wght@300;400;700&family=Nunito+Sans:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600;1,700&family=Sen:wght@400;700&Crimson+Text:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>

<body class="article" onload="mainfunc()">
    <header class="site-header">
        <div class="site-logo">

        </div>
        <div class="menu-toggle" id="menuToggle">Menu</div>
        <nav>
           
        </nav>
    </header>
    <main>
        <article>
            <figure class="feature-image">
                <img src="assets/img/Trump_and_Biden_with_American_flag.jpg" alt="Trump and Biden with American flag">
            </figure>
            <header class="entry-header">
                <h1>Every US Election Result in 60 Seconds</h1>
                <p>Understand how political opinion in the United States has changed over the last 50 years.</p>
            </header>
            <div class="entry-content">
                <section class="kpis">
                    <h2>Snapshot</h2>
                    <p>How has political power in America changed?</p>
                    <ul>
                        <li>
                            <div>
                                <b id="democratWins">0%</b> Democrats
                                <small>since <span id="firstYear"></span></small>
                            </div>
                        </li>
                        <li>
                            <div>
                                <b id="democratsWinsInLast20Years">0%</b> Democrats
                                <small>in the last 20 years</small>
                            </div>
                        </li>
                        <li>
                            <div>
                                <b id="statesVotedDemocratsMost"></b>
                                <small>has voted Democrat the most</small>
                            </div>
                        </li>
                        <li>
                            <div>
                                <b id="statesVotedRepublicanMost"></b>
                                <small>has voted Republican the most</small>
                            </div>
                        </li>
                        <li>
                            <div>
                                <b id="presidentWithHighWinPercentage"></b>
                                <small>won by the largest percentage</small>
                            </div>
                        </li>
                        <li>
                            <div>
                                <b id="mostRepeatedWins"></b>
                                <small id="mostRepeatedWinsDetails"></small>
                            </div>
                        </li>
                    </ul>
                </section>
                <section class="animated-map">
                    <header>
                        <h2>How each state has voted since the first election</h2>
                        <p>How has America voted in the past?</p>
                    </header>
                    <div id="regions_div" style="width: 100%; height: 500px;"></div>

                    <h3 id="yearHeading"></h3>
                </section>
                <section class="timeline">
                    <ol>
                    <li>
                    <time id="electionYear"></time>
                    <h3 id="presidentName"></h3>
                    <p style="color: white;" id="partyName"></p>
                    </li>
                    </ol>
                    </section>
                    <section class="graph">

                        <div style="width:100%;">
                            <canvas id="canvas"></canvas>
                        </div>
                    </section>
            </div>
            <!-- .entry-co
                <section class="timeline">
                    <header>
                        <h2>Every American Election Result</h2>
                        <p>How has America voted in the past?</p>
                    </header>
                    <p>Timeline here: Simply display the name of the president per year and whether they're democrat or Republican or other.</p>
                    <ol>
                        <li class="party-name">
                            <h3><small>Year</small> President Name</h3>
                            <p>Party Name</p>
                        </li>
                    </ol>
                </section>
            </div>
            <!-- .entry-content -->
        </article>
    </main>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw==" crossorigin="anonymous"></script>
    <script type="text/javascript">


        /* graph code starts here */
        var years = [];
        var democratsChartData = [];
        var republicansChartData = [];
        function drawGraph(){
            var config = {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Democrat',
                        borderColor: 'blue',
                        backgroundColor: 'blue',
                        data: democratsChartData
                    }, {
                        label: 'Republican',
                        borderColor: 'red',
                        backgroundColor: 'red',
                        data: republicansChartData
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: ''
                    },
                    tooltips: {
                        mode: 'index',
                    },
                    hover: {
                        mode: 'index'
                    },
                    scales: {
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Year'
                            }
                        }],
                        yAxes: [{
                            stacked: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Electoral Votes'
                            }
                        }]
                    }
                }
            };
            var ctx = document.getElementById('canvas').getContext('2d');
            var stackedLine = new Chart(ctx, config);
        }

        function prepareGraphData(year, electoralVotes, value){
            years.push(year);
            if (value.winning_party === "Dem.") {
                democratsChartData.push(parseInt(electoralVotes[0]));
                republicansChartData.push(electoralVotes[1] - electoralVotes[0]);
            }
            else if (value.winning_party === "Rep.") {
                democratsChartData.push(electoralVotes[1] - electoralVotes[0])
                republicansChartData.push(parseInt(electoralVotes[0]));
            }
            else{
                democratsChartData.push(0)
                republicansChartData.push(0);
            }
        }

        /* graph code ends here*/

        /* google chart code starts here */
        // load chart
        google.charts.load('current', {
            'packages': ['geochart'],
            'mapsApiKey': 'AIzaSyAgDf2DBQwy33XYxD7jKmO0AIo5TT06Q0U'
        });
        google.charts.setOnLoadCallback(drawRegionsMap);

        // chart callback function
        function drawRegionsMap() {
            var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
            // read json data
            $.getJSON("http://45.63.15.162:8000/data/election_results.json", function (jsonList) {
                var index = 0;
                var states = Object.values(jsonList)[0];
                var voteMargins = Object.values(jsonList)[1];
                var length =  Object.values(states)[0].length;
                var democratsWins = 0;

                var currentYear = new Date().getFullYear();
                var democratsWinsInLast20Years = 0;
                var electionsInLast20Years = 0;

                var highestWinPercentage = 0;
                var presidentWithHighWinPercentage = "";

                jQuery.each(voteMargins, function (index, value) {
                    var year=parseInt(value.year);
                    if (year>=currentYear-20){
                            electionsInLast20Years++;
                            if (value.winning_party === "Dem.") {
                                democratsWinsInLast20Years++;
                            }
                        }

                    if (value.winning_party === "Dem.") {
                        democratsWins++;
                    }

                    var electoralVotes = value.electoral_votes.split('/');
                    var winPercentage= parseInt(electoralVotes[0]/electoralVotes[1]*100);
                    if (winPercentage>highestWinPercentage){
                        highestWinPercentage = winPercentage;
                        if (!presidentWithHighWinPercentage.includes(value.president_name)){
                            if (presidentWithHighWinPercentage===""){
                                presidentWithHighWinPercentage = value.president_name;
                            }
                            else{
                                presidentWithHighWinPercentage += ", " + value.president_name;
                            }

                        }
                    }

                    prepareGraphData(year, electoralVotes, value);
                });

                $("#presidentWithHighWinPercentage").text(presidentWithHighWinPercentage);
                var statesVotedDemocratsMost = "";
                var highestDemocratWinsFrom1State = -1;

                var statesVotedRepublicanMost = "";
                var highestRepublicanWinsFrom1State = -1;

                jQuery.each(states, function (name, details){
                    var voteToDemocrat = 0;
                    var voteToRepublican = 0;
                    jQuery.each(details, function (index, value){
                        if (value.result === "R") {
                            voteToRepublican++;
                        }
                        else if (value.result === "D") {
                            voteToDemocrat++;
                        }
                    });

                    if (highestDemocratWinsFrom1State < voteToDemocrat){
                        highestDemocratWinsFrom1State = voteToDemocrat;
                        statesVotedDemocratsMost = name;
                        //console.log(name + ": " + voteToDemocrat);
                    }
                    else if(highestDemocratWinsFrom1State === voteToDemocrat){
                        statesVotedDemocratsMost += ", " + name;
                        //console.log(name + ": " + voteToDemocrat);
                    }

                    if (highestRepublicanWinsFrom1State < voteToRepublican){
                        highestRepublicanWinsFrom1State = voteToRepublican;
                        statesVotedRepublicanMost = name;
                        //console.log(name + ": " + voteToRepublican);
                    }
                    else if(highestRepublicanWinsFrom1State === voteToRepublican){
                        statesVotedRepublicanMost += ", " + name;
                        //console.log(name + ": " + voteToRepublican);
                    }
                });

                //console.log(highestDemocratWinsFrom1State);
                $("#statesVotedDemocratsMost").text(statesVotedDemocratsMost);
                $("#statesVotedRepublicanMost").text(statesVotedRepublicanMost);

                if (highestDemocratWinsFrom1State>highestRepublicanWinsFrom1State){
                    $("#mostRepeatedWins").text(statesVotedDemocratsMost);
                    $("#mostRepeatedWinsDetails").text("has voted Democrat " + highestDemocratWinsFrom1State + " times.")
                }
                else{
                    $("#mostRepeatedWins").text(statesVotedRepublicanMost);
                    $("#mostRepeatedWinsDetails").text("has voted Republican " + highestRepublicanWinsFrom1State + " times.")
                }


                $("#democratWins").text(parseInt(democratsWins/length*100) + "%");
                $("#firstYear").text(voteMargins[0].year);
                $("#democratsWinsInLast20Years").text(parseInt(democratsWinsInLast20Years/electionsInLast20Years*100) + "%");

                var options = {
                    resolution: 'provinces',
                    region: 'US',
                    colorAxis: {
                        colors: ['red', 'blue'],
                        values: [1, 2]
                    },
                    legend: 'none',
                    tooltip: {
                        isHtml: true
                    }
                };
                var interval = setInterval(function () {
                    var stateDataArray = [];
                    stateDataArray.push(['State', 'Winner', { role: 'tooltip', p: { html: true } }]);

                    $('#electionYear').text(voteMargins[index].year);
                    $('#presidentName').text(voteMargins[index].president_name);
                    $('#partyName').text(voteMargins[index].winning_party);

                    jQuery.each(states, function (state, value) {
                        if (value[index].result === "R") {
                            stateDataArray.push([state, 1, value[index].year + " Republican"]);
                        }
                        else if (value[index].result === "D") {
                            stateDataArray.push([state, 2, value[index].year + " Democrat"]);
                        }
                    });

                    // reset chart
                    var data = google.visualization.arrayToDataTable(stateDataArray);
                    chart.clearChart();
                    chart.draw(data, options);

                    index++;
                    // if array ends then stop iteration
                    if (index === length) {
                        clearInterval(interval);
                    }
                }, 1000);
            }).done(function(){
                drawGraph();
            });
        }

    </script>

</body>
</html>
